{# =============================================================
   Arquivo: dompdf.twig
   Seção: DOMPDF
   Descrição: Biblioteca PHP utilizada para geração de documentos PDF no MeuApp MVC.
   Autor: Lucio Lemos
   Última atualização: {{ "now"|date("d/m/Y") }}
   ============================================================= #}

{% extends "layouts/base.twig" %}
{% import "partials/macros.twig" as ui %}

{% block title %}{{ app_name }} — DOMPDF{% endblock %}

{% block extra_css %}
  {{ parent() }}
  {% if not export %}
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  {% endif %}
  <link rel="stylesheet" href="/css/style.css">
{% endblock %}

{% block content %}
  <div class="container py-4" {% if not export %}data-aos="fade-in"{% endif %}>

    {% if not export %}
      <div class="text-end mb-3" data-aos="fade-left" data-aos-delay="120">
        <a href="/pdf/dompdf" class="btn btn-outline-danger">
          <i class="fas fa-file-pdf"></i> Exportar PDF
        </a>
      </div>
    {% endif %}

    {# ===================== CABEÇALHO PRINCIPAL ===================== #}
    {{ ui.header(title, subtitle, description, author, date, export) }}

    <section class="mb-5 pdf-section">
      <h2 class="h4 text-secondary mb-3" {% if not export %}data-aos="fade-right" data-aos-delay="60"{% endif %}>
        Geração de PDFs com DOMPDF
      </h2>

      <p class="text-justify"
         {% if not export %}data-aos="fade-up" data-aos-delay="100"{% endif %}>
        O <strong>DOMPDF</strong> é a biblioteca PHP utilizada no <strong>MeuApp MVC</strong> para geração de relatórios, manuais e documentos
        em formato <em>Portable Document Format (PDF)</em>. Ele converte código <strong>HTML</strong> e <strong>CSS</strong> diretamente em PDFs,
        preservando o layout e a formatação do conteúdo renderizado no navegador.
      </p>

      <p class="text-justify"
         {% if not export %}data-aos="fade-up" data-aos-delay="140"{% endif %}>
        Essa integração garante que os templates do <strong>Twig</strong> possam ser reutilizados tanto na versão web quanto na exportação em PDF,
        mantendo consistência visual e eliminando redundâncias no código.
      </p>

      {# ===================== 1. Instalação ===================== #}
      <h3 class="h6 text-primary mt-4">
        {% if export %}
          1. Instalação e Configuração
        {% else %}
          <span data-aos="zoom-in" data-aos-delay="180"><i class="fas fa-download"></i> Instalação e Configuração</span>
        {% endif %}
      </h3>

      <p class="text-justify"
         {% if not export %}data-aos="fade-up" data-aos-delay="200"{% endif %}>
        O DOMPDF é instalado via <code>Composer</code>, garantindo fácil atualização e compatibilidade. Após a instalação,
        o serviço de PDF pode ser inicializado e chamado por qualquer <em>controller</em> do projeto.
      </p>

      <div {% if not export %}data-aos="flip-up" data-aos-delay="220"{% endif %}>
        {{ ui.codeblock_pro('composer.json', 'composer require dompdf/dompdf', 'bash', 'light') }}
      </div>

      {# ===================== 2. Controller ===================== #}
      <h3 class="h6 text-primary mt-4">
        {% if export %}
          2. Exemplo de Uso no Controller
        {% else %}
          <span data-aos="zoom-in" data-aos-delay="260"><i class="fas fa-code"></i> Exemplo de Uso no Controller</span>
        {% endif %}
      </h3>

      <p class="text-justify"
         {% if not export %}data-aos="fade-up" data-aos-delay="280"{% endif %}>
        O exemplo abaixo demonstra como gerar um PDF a partir de um template Twig. O conteúdo HTML é renderizado e então passado ao DOMPDF,
        que o converte em um arquivo PDF para download.
      </p>

      <div {% if not export %}data-aos="flip-up" data-aos-delay="300"{% endif %}>
{{ ui.codeblock_pro(
  'PdfController.php',
  '<?php
use Dompdf\\Dompdf;
use Dompdf\\Options;

$options = new Options();
$options->set("isHtml5ParserEnabled", true);
$options->set("isRemoteEnabled", true);

$dompdf = new Dompdf($options);

$html = $twig->render("pdf/manual.twig", [
    "title" => "Manual do Paciente",
    "content" => $conteudo
]);

$dompdf->loadHtml($html);
$dompdf->setPaper("A4", "portrait");
$dompdf->render();
$dompdf->stream("manual-usuario.pdf", ["Attachment" => false]);
?>',
  'php',
  'dark'
) }}
      </div>

      {# ===================== 3. Integração Twig ===================== #}
      <h3 class="h6 text-primary mt-4">
        {% if export %}
          3. Integração com o Twig
        {% else %}
          <span data-aos="zoom-in" data-aos-delay="340"><i class="fas fa-link"></i> Integração com o Twig</span>
        {% endif %}
      </h3>

      <p class="text-justify"
         {% if not export %}data-aos="fade-up" data-aos-delay="360"{% endif %}>
        A integração entre o <strong>DOMPDF</strong> e o <strong>Twig</strong> é direta: o mesmo template utilizado na exibição web
        pode ser renderizado em PDF, bastando passar as mesmas variáveis. Essa abordagem mantém a uniformidade visual
        e reduz a duplicação de código.
      </p>

      {# ===================== 4. Boas práticas ===================== #}
      <h3 class="h6 text-primary mt-4">
        {% if export %}
          4. Boas Práticas de Utilização
        {% else %}
          <span data-aos="zoom-in" data-aos-delay="400"><i class="fas fa-lightbulb"></i> Boas Práticas de Utilização</span>
        {% endif %}
      </h3>

      <ul class="small list-unstyled ms-3">
        {% set dicas = [
          'Prefira templates Twig reutilizáveis entre visualização e exportação PDF.',
          'Utilize estilos inline ou arquivos CSS externos simples (sem JavaScript).',
          'Defina corretamente o tamanho do papel e a orientação (<code>A4</code>, <code>portrait</code>, <code>landscape</code>).',
          'Evite efeitos dinâmicos e animações — o DOMPDF não processa JavaScript.',
          'Teste a renderização visualmente para garantir margens e espaçamento adequados.'
        ] %}
        {% for dica in dicas %}
          <li {% if not export %}data-aos="fade-up" data-aos-delay="{{ 420 + (60 * loop.index) }}"{% endif %}>
            <i class="fas fa-check text-success"></i> {{ dica|raw }}
          </li>
        {% endfor %}
      </ul>

      <div class="alert alert-info small mt-3"
           {% if not export %}data-aos="fade-up" data-aos-delay="{{ 420 + (60 * (dicas|length + 1)) }}"{% endif %}>
        <i class="fas fa-info-circle"></i>
        O uso do <strong>DOMPDF</strong> no <strong>MeuApp MVC</strong> permite gerar relatórios profissionais e exportar conteúdos
        com o mesmo layout das páginas, reforçando a integração entre frontend e backend.
      </div>
    </section>
  </div>
{% endblock %}

{% block extra_js %}
  {{ parent() }}
  {% if not export %}
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        AOS.init({
          duration: 550,
          easing: 'ease-out',
          once: true,
          offset: 12
        });
      });
    </script>
  {% endif %}
{% endblock %}
