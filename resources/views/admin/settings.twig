{% extends "layouts/admin.twig" %}

{% block extra_css %}
  {{ parent() }}
  <style>
    .settings-card {
      border-radius: 1.25rem;
      border: 1px solid rgba(15, 23, 42, 0.06);
      box-shadow: 0 1.25rem 2.5rem rgba(15, 23, 42, 0.08);
      overflow: hidden;
    }
    .settings-section__title {
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #64748b;
      margin-bottom: 0.85rem;
      font-weight: 600;
    }
    .form-switch .form-check-input:checked {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }
    .settings-meta {
      font-size: 0.8rem;
      color: #64748b;
    }
  </style>
{% endblock %}

{% block admin_content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h4 mb-1"><i class="fas fa-sliders-h me-2"></i>{{ title }}</h1>
      <p class="settings-meta mb-0">Ajuste preferências globais usadas pelo site público e pelo painel.</p>
    </div>
    <a href="/admin/dashboard" class="btn btn-outline-secondary btn-sm">
      <i class="fas fa-arrow-left me-1"></i> Voltar
    </a>
  </div>

  {% if status %}
    {% set alertClass = status == 'success' ? 'alert-success' : 'alert-danger' %}
    <div class="alert {{ alertClass }} alert-dismissible fade show" role="alert">
      <i class="fas {{ status == 'success' ? 'fa-check-circle' : 'fa-triangle-exclamation' }} me-2"></i>
      {{ message ?? 'Operação concluída.' }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
    </div>
  {% endif %}

  <div class="settings-card bg-white p-4 p-lg-5">
    <form action="/admin/settings/update" method="post" class="needs-validation" novalidate>
      <div class="row g-4">
        <div class="col-12">
          <span class="settings-section__title">Identidade do aplicativo</span>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="appName" class="form-label">Nome da aplicação *</label>
              <input type="text" class="form-control" id="appName" name="app_name" value="{{ settings.app_name|default('') }}" required>
              <div class="invalid-feedback">Informe o nome que será exibido no site e no painel.</div>
            </div>
            <div class="col-md-6">
              <label for="appTagline" class="form-label">Tagline / descrição curta</label>
              <input type="text" class="form-control" id="appTagline" name="app_tagline" value="{{ settings.app_tagline|default('') }}" placeholder="Ex: Plataforma de conteúdo MeuApp">
            </div>
          </div>
        </div>

        <div class="col-12">
          <span class="settings-section__title">Contato oficial</span>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="contactEmail" class="form-label">E-mail de contato</label>
              <input type="email" class="form-control" id="contactEmail" name="contact_email" value="{{ settings.contact_email|default('') }}" placeholder="contato@meuapp.local">
              <div class="form-text">Utilizado em rodapés, mensagens automáticas e suporte.</div>
            </div>
            <div class="col-md-6">
              <label for="supportPhone" class="form-label">Telefone / WhatsApp</label>
              <input type="text" class="form-control" id="supportPhone" name="support_phone" value="{{ settings.support_phone|default('') }}" placeholder="+55 11 99999-9999">
            </div>
          </div>
        </div>

        <div class="col-12">
          <span class="settings-section__title">Ambiente e depuração</span>
          <div class="row g-3">
            <div class="col-md-4">
              <label for="timezone" class="form-label">Fuso horário</label>
              {% set timezones = {
                'America/Sao_Paulo': 'America/Sao_Paulo (GMT-3)',
                'America/Manaus': 'America/Manaus (GMT-4)',
                'America/Fortaleza': 'America/Fortaleza (GMT-3)',
                'UTC': 'UTC (Tempo Universal)',
                'Europe/Lisbon': 'Europe/Lisbon (GMT+0)'
              } %}
              <select name="timezone" id="timezone" class="form-select">
                {% for tzValue, tzLabel in timezones %}
                  <option value="{{ tzValue }}" {% if settings.timezone == tzValue %}selected{% endif %}>{{ tzLabel }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-4">
              <label for="appEnv" class="form-label">Ambiente</label>
              <select name="app_env" id="appEnv" class="form-select">
                {% set envOptions = {
                  'dev': 'Desenvolvimento',
                  'staging': 'Homologação',
                  'production': 'Produção'
                } %}
                {% for envValue, envLabel in envOptions %}
                  <option value="{{ envValue }}" {% if settings.app_env == envValue %}selected{% endif %}>{{ envLabel }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Modo debug</label>
              <div class="form-check form-switch mt-2">
                <input class="form-check-input" type="checkbox" role="switch" id="appDebug" name="app_debug" value="1" {% if settings.app_debug %}checked{% endif %}>
                <label class="form-check-label" for="appDebug">Exibir mensagens detalhadas de erro (apenas em ambientes internos).</label>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 d-flex justify-content-end gap-2 mt-4">
          <a href="/admin/dashboard" class="btn btn-outline-secondary">
            Cancelar
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-2"></i>Salvar alterações
          </button>
        </div>
      </div>
    </form>
    {% if settings.updated_at %}
      <p class="settings-meta mt-4 mb-0">
        <i class="fas fa-clock me-2"></i>Última atualização: {{ settings.updated_at|date('d/m/Y H:i') }}
      </p>
    {% endif %}
  </div>

  <p class="settings-meta mt-4">
    <i class="fas fa-circle-info me-1"></i>As configurações ficam registradas em <code>storage/data/settings.json</code>. Ajuste arquivos PHP de configuração manualmente se precisar refletir os valores em tempo de execução.
  </p>
{% endblock %}
