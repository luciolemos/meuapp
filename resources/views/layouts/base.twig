{% macro asset_url(base, path) %}
  {%- set base = base ?? '/' -%}
  {%- set clean = path|trim('/') -%}
  {%- if path starts with 'http://' or path starts with 'https://' %}
    {{ path }}
  {%- elseif base == '' or base == '/' -%}
    /{{ clean }}
  {%- elseif base matches '/^https?:\\/\\//' -%}
    {{ base|trim('/') ~ '/' ~ clean }}
  {%- else -%}
    /{{ base|trim('/') ~ '/' ~ clean }}
  {%- endif -%}
{% endmacro %}

{% from _self import asset_url %}
{% set asset_base = base_url ?? '/' %}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>

  <!-- Frameworks principais -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

  <!-- Estilos organizados -->
  <link rel="stylesheet" href="{{ asset_url(asset_base, 'css/style.css') }}">
  <link rel="stylesheet" href="{{ asset_url(asset_base, 'css/navbar.css') }}">
  <link rel="stylesheet" href="{{ asset_url(asset_base, 'css/theme-dark.css') }}">
  <!-- Inicializa tema antes do carregamento -->
  
  <script>
    (() => {
      try {
        const savedTheme = localStorage.getItem('theme');
        const theme = savedTheme === 'dark' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-bs-theme', theme);
      } catch {
        document.documentElement.setAttribute('data-bs-theme', 'light');
      }
    })();
  </script>



    {% block extra_css %}
    <style>
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .navbar-nav .nav-link {
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .navbar-nav .nav-link:hover {
            color: #0d6efd;
            transform: translateY(-1px);
        }

        .dropdown-menu .dropdown-item:hover {
            background-color: #f8f9fa;
            color: #0d6efd;
        }

        .theme-toggle {
            cursor: pointer;
            border: none;
            background: transparent;
            color: inherit;
            transition: transform 0.2s ease;
        }
        .theme-toggle:hover {
            transform: rotate(15deg);
        }

/* ======== TEMA ESCURO ======== */
        [data-bs-theme="dark"] .hero-section {
            background: linear-gradient(135deg, #0b1524, #0d1b2a);
            color: #eaeaea;
        }
        [data-bs-theme="dark"] .hero-overlay {
            background: radial-gradient(circle at 30% 50%, rgba(255,255,255,0.05), transparent 70%),
                        radial-gradient(circle at 70% 50%, rgba(255,255,255,0.05), transparent 70%);
        }
        [data-bs-theme="dark"] .card {
            background-color: #1f1f1f !important;
            color: #eaeaea !important;
            border-color: #333 !important;
        }
        [data-bs-theme="dark"] .bg-light {
            background-color: #1c1c1c !important;
        }
        [data-bs-theme="dark"] .text-muted {
            color: #b5b5b5 !important;
        }
        [data-bs-theme="dark"] .border {
            border-color: #333 !important;
        }
        /* === Corrigir sobreposi√ß√£o do dropdown === */
.navbar { z-index: 2100 !important; position: relative; }
.dropdown-menu { z-index: 2000 !important; }
.hero-section, main, section { overflow: visible !important; }

    </style>
    {% endblock %}
</head>

<body class="d-flex flex-column min-vh-100">

    {% if not export %}
        {% include "partials/navbar.twig" %}
    {% endif %}

    <main class="container py-5 flex-grow-1">
        {% block content %}{% endblock %}
    </main>

    {% if not export %}
        {% include "partials/footer.twig" %}
    {% endif %}

  <!-- Scripts principais -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Mermaid para diagramas -->
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true, theme: "neutral", securityLevel: 'loose'});
  </script>

    <!-- üîπ Controle global de modo escuro -->
    <script>
        (function () {
            function initThemeAndDropdowns() {
            const html = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            if (!themeToggle) {
                return;
            }

            const icon = themeToggle.querySelector('i');
            const savedTheme = localStorage.getItem('theme');
            const initialTheme = savedTheme === 'dark' ? 'dark' : 'light';

            html.setAttribute('data-bs-theme', initialTheme);
            updateBodyTheme(initialTheme);
            updateIcon(initialTheme);

            themeToggle.addEventListener('click', function() {
                const newTheme = html.getAttribute('data-bs-theme') === 'light' ? 'dark' : 'light';
                html.setAttribute('data-bs-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateBodyTheme(newTheme);
                updateIcon(newTheme);
            });

            function updateBodyTheme(theme) {
                const body = document.body;
                if (!body) return;
                if (theme === 'dark') {
                    body.classList.remove('bg-light', 'text-dark');
                    body.classList.add('bg-dark', 'text-light');
                } else {
                    body.classList.remove('bg-dark', 'text-light');
                    body.classList.add('bg-light', 'text-dark');
                }
            }

            function updateIcon(theme) {
                if (theme === 'dark') {
                    icon.classList.add('fa-sun');
                    icon.classList.remove('fa-moon');
                    icon.title = 'Modo claro';
                } else {
                    icon.classList.add('fa-moon');
                    icon.classList.remove('fa-sun');
                    icon.title = 'Modo escuro';
                }
            }

            if (window.bootstrap && typeof window.bootstrap.Dropdown === 'function') {
                document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(function(toggle) {
                    window.bootstrap.Dropdown.getOrCreateInstance(toggle, { autoClose: 'outside' });
                });
            }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initThemeAndDropdowns);
            } else {
                initThemeAndDropdowns();
            }
        })();
    </script>

  {% block extra_js %}
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init({ duration: 1000, once: true });
    </script>
  {% endblock %}
</body>
</html>
